<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Historique des Absences</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>

<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-image: url('./assets/background.jpg');
        /* Path to your image */
        background-size: cover;
        background-position: center;
        min-height: 100vh;
        /* Set the minimum height to cover the viewport */
        display: flex;
        align-items: center;
        /* Centrer verticalement */
        justify-content: center;
        /* Centrer horizontalement */
    }

    h1 {
        text-align: center;
    }

    form {
        max-width: 400px;
        margin: 20px auto;
        padding: 20px;
        background-color: #fff;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    label {
        display: block;
        margin-bottom: 10px;
    }

    input[type="text"] {
        width: 100%;
        padding: 10px;
        margin-bottom: 20px;
        border: 1px solid #ccc;
        border-radius: 5px;
        box-sizing: border-box;
    }

    button[type="submit"] {
        width: 100%;
        padding: 10px;
        background-color: #007bff;
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    button[type="submit"]:hover {
        background-color: #0056b3;
    }

    #absenceHistory {
        max-width: 800px;
        margin: 20px auto;
        padding: 20px;
        background-color: #fff;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    #absenceHistory h2 {
        margin-bottom: 10px;
        color: #333;
    }

    #absenceHistory table {
        width: 100%;
        border-collapse: collapse;
    }

    #absenceHistory th,
    #absenceHistory td {
        padding: 8px;
        border: 1px solid #ddd;
        text-align: left;
    }

    #absenceHistory th {
        background-color: #f2f2f2;
    }

     /* Sidebar styles */
     .sidebar {
      height: 100%;
      width: 200px;
      position: fixed;
      top: 0;
      left: 0;
      background-color: #f0f0f0;
      padding-top: 10px;
    }

    /* Style for the links inside the sidebar */
    .sidebar a {
      text-decoration: none;
      color: #333;
      display: block;
      padding: 10px 20px;
      transition: background-color 0.3s ease;
    }

    /* Hover effect for sidebar links */
    .sidebar a:hover {
      background-color: #ddd;
    }

    .sidebar-logo {
      width: 100px;
      /* Définissez la largeur souhaitée */
      height: auto;
      /* La hauteur s'ajustera automatiquement pour maintenir les proportions de l'image */
      display: block;
      /* Assurez-vous que l'image est affichée comme un bloc */
      margin: 0 auto;
      margin-bottom: 100px;
      /* Centrez l'image horizontalement */
      padding: 10px;
      /* Ajoutez un peu d'espace autour de l'image si nécessaire */
    }

</style>

<body>
    <div class="sidebar">
        <img src="./assets/ensaj.png" alt="" class="sidebar-logo">
        <a href="home.html"><i class="fas fa-home"></i> Home</a>
        <a href="dashboards.html"><i class="fas fa-chart-bar"></i> Dashboard</a>
        <a href="absences.html"><i class="fas fa-calendar-alt"></i> Absences</a>
        <a href="abcencesByEtudiant.html"><i class="fas fa-copy"></i> Details </a>
        <a href="demandes.html"><i class="fas fa-tasks"></i> Demandes </a>
        <a href="./index.html"><i class="fas fa-sign-out-alt"></i> Logout</a>
      </div>

    <div style="text-align: center;">
        <h1 id="titre">Historique des Absences</h1>

        
        <select id="filter-select" class="filter">
            <option value="ADNAN_KHADIJA">ADNAN KHADIJA</option>
<option value="AKHERRAZ_SANA">AKHERRAZ SANA</option>
<option value="AKHMIM_ABDELILAH">AKHMIM ABDELILAH</option>
<option value="BAGHDAD_GHITA">BAGHDAD GHITA</option>
<option value="BAJEDDI_NASSIMA">BAJEDDI NASSIMA</option>
<option value="BERHIL_AYA">BERHIL AYA</option>
<option value="BOUPOUCHI_ANASS">BOUPOUCHI ANASS</option>
<option value="CHTIOUI_SALMA">CHTIOUI SALMA</option>
<option value="El GARDA_BASMA">El GARDA BASMA</option>
<option value="EL HABBOULI_KHOULOUD">EL HABBOULI KHOULOUD</option>
<option value="EL MOUWAHID_AYOUB">EL MOUWAHID AYOUB</option>
<option value="ENNAHI_SAAD">ENNAHI SAAD</option>
<option value="ERRAHIMI_OUSSAMA">ERRAHIMI OUSSAMA</option>
<option value="ESKANDAR_OUMAIMA">ESKANDAR OUMAIMA</option>
<option value="ESSAOULAJY_MANAL">ESSAOULAJY MANAL</option>
<option value="FEZZAZI_MOHAMED">FEZZAZI MOHAMED</option>
<option value="GHAZI_YASSINE">GHAZI YASSINE</option>
<option value="HATTI_HASNA">HATTI HASNA</option>
<option value="KASBI_MOHAMMED">KASBI MOHAMMED</option>
<option value="KORAICHI_CHOUAIB">KORAICHI CHOUAIB</option>
<option value="KOUACH_WAFAA">KOUACH WAFAA</option>
<option value="KOUAME_SAMYA">KOUAME SAMYA</option>
<option value="LAAOUIBI_MOHAMED">LAAOUIBI MOHAMED</option>
<option value="LAGNIDI_AMINA">LAGNIDI AMINA</option>
<option value="LAHRECH_ISSAM">LAHRECH ISSAM</option>
<option value="LAILI_ASMAA">LAILI ASMAA</option>
<option value="MABSOUT_MOHAMED">MABSOUT MOHAMED</option>
<option value="MOUFID_AMINE">MOUFID AMINE</option>
<option value="NAINIA_ASMAA">NAINIA ASMAA</option>
<option value="OIFIK_AYOUB">OIFIK AYOUB</option>
<option value="OUARARI_KAWTAR">OUARARI KAWTAR</option>
<option value="OUARDINE_NASSIMA">OUARDINE NASSIMA</option>
<option value="OUICHOU_WISSAL">OUICHOU WISSAL</option>
<option value="OUKDOUR_AICHA">OUKDOUR AICHA</option>
<option value="RACHYQ_MERYEM">RACHYQ MERYEM</option>
<option value="RAKI_KENZA">RAKI KENZA</option>
<option value="SAKHR_YASSINE">SAKHR YASSINE</option>
<option value="SORHRANI_ISMAIL">SORHRANI ISMAIL</option>
</select>

        <!-- Conteneur pour afficher l'historique des absences -->
        <div id="absenceHistory"></div>
    </div>

    <script>
        // Fonction pour récupérer les données d'absences en fonction du nom et prénom de l'étudiant
        function fetchAbsenceHistory() {
            var selectedStudent = document.getElementById("filter-select").value;
            var studentName = selectedStudent;

            // Supprimer les espaces autour du nom de l'étudiant
            studentName = studentName.trim();

            // Si le nom de l'étudiant est vide, ne pas effectuer de requête
            if (!studentName) {
                console.error("Le nom de l'étudiant est vide.");
                return;
            }

            var apiUrl = 'https://script.google.com/macros/s/AKfycbxppvLIzg7AfQUvcVeOi5aPQyO3bzQJy_ck2DAo5otKkwhFI4RejS6XLE1txFnG3pij/exec?justif=true&nom=' + studentName;

            // Requête GET pour récupérer les données d'absences
            fetch(apiUrl)
                .then(response => response.json())
                .then(data => {
                    var historyContainer = document.getElementById('absenceHistory');
                    historyContainer.innerHTML = '';

                    if (data.j.length === 0 && data.nj.length === 0) {
                        historyContainer.innerHTML = '<p>AUCUNE ABSENCE</p>';
                        return;
                    }

                    var table = document.createElement('table');
                    var thead = document.createElement('thead');
                    var tbody = document.createElement('tbody');

                    var headerRow = document.createElement('tr');
                    var headers = ['Date', 'Heure', 'Module', 'Justifiée', 'Selectionner'];
                    headers.forEach(headerText => {
                        var th = document.createElement('th');
                        th.textContent = headerText;
                        headerRow.appendChild(th);
                    });
                    thead.appendChild(headerRow);

                    data.j.forEach((absence, index) => {
                        var tr = document.createElement('tr');
                        var tdDate = document.createElement('td');
                        var formattedDate = new Date(absence.date).toISOString().split('T')[0];
                        tdDate.textContent = formattedDate;
                        var tdHeure = document.createElement('td');
                        tdHeure.textContent = absence.heure;
                        var tdModule = document.createElement('td');
                        tdModule.textContent = absence.module;
                        var tdJustifiee = document.createElement('td');
                        tdJustifiee.textContent = 'Oui';
                        var tdCheckbox = document.createElement('td');
                        var checkbox = document.createElement('input');
                        checkbox.type = 'checkbox';
                        checkbox.addEventListener('change', function() {
                            if (this.checked) {
                                console.log('Index de la ligne sélectionnée:', index);
                            }
                        });
                        tdCheckbox.appendChild(checkbox);
                        tr.appendChild(tdDate);
                        tr.appendChild(tdHeure);
                        tr.appendChild(tdModule);
                        tr.appendChild(tdJustifiee);
                        tr.appendChild(tdCheckbox);
                        tbody.appendChild(tr);
                    });

                    data.nj.forEach((absence, index) => {
                        var tr = document.createElement('tr');
                        var tdDate = document.createElement('td');
                        var formattedDate = new Date(absence.date).toISOString().split('T')[0];
                        tdDate.textContent = formattedDate;
                        var tdHeure = document.createElement('td');
                        tdHeure.textContent = absence.heure;
                        var tdModule = document.createElement('td');
                        tdModule.textContent = absence.module;
                        var tdJustifiee = document.createElement('td');
                        tdJustifiee.textContent = 'Non';
                        var tdCheckbox = document.createElement('td');
                        var checkbox = document.createElement('input');
                        checkbox.type = 'checkbox';
                        checkbox.addEventListener('change', function() {
                            if (this.checked) {
                                console.log('Index de la ligne sélectionnée:', index);
                            }
                        });
                        tdCheckbox.appendChild(checkbox);
                        tr.appendChild(tdDate);
                        tr.appendChild(tdHeure);
                        tr.appendChild(tdModule);
                        tr.appendChild(tdJustifiee);
                        tr.appendChild(tdCheckbox);
                        tbody.appendChild(tr);
                    });

                    table.appendChild(thead);
                    table.appendChild(tbody);
                    historyContainer.appendChild(table);
                })
                .catch(error => {
                    console.error('Erreur lors de la récupération de l\'historique des absences :', error);
                });
        }
      
       // Appeler fetchAbsenceHistory lorsque la sélection d'étudiant change
       document.getElementById('filter-select').addEventListener('change', fetchAbsenceHistory);

       // Appeler fetchAbsenceHistory au chargement de la page
       fetchAbsenceHistory();

       // Fonction pour confirmer la sélection des index dans la console
       document.getElementById('confirmButton').addEventListener('click', function() {
           console.log('Confirmation de la sélection des index.');
       });
    </script>
</body>

</html>
